<ion-header class="site-header">
  <ion-toolbar color="light">
    <div class="container navbar">
      <div class="brand">
        <ion-icon name="sparkles-outline"></ion-icon>
        <span>Hotel Pacific Reef</span>
      </div>
      <nav class="menu">
        <a routerLink="/home" routerLinkActive="active">{{ 'header.home' | translate }}</a>
        <a routerLink="/reservas" routerLinkActive="active">{{ 'header.reservas' | translate }}</a>
        <a routerLink="/perfil" routerLinkActive="active">{{ 'header.perfil' | translate }}</a>
        <span *ngIf="currentEmail" class="user-pill">{{ 'header.hello' | translate }} <b>{{ currentEmail }}</b></span>
        <a href="#" class="logout" (click)="logout($event)">{{ 'header.logout' | translate }}</a>
      </nav>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="site-content ion-padding">
  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ 'pago.title' | translate }}</ion-card-title>
      <ion-card-subtitle>{{ 'pago.subtitle' | translate }}</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <!-- Resumen de reserva -->
      <ion-list-header>
        <ion-label>{{ 'pago.summary' | translate }}</ion-label>
      </ion-list-header>
      
      <ion-item>
        <ion-label>
          <h3>{{ habitacion?.nombre }}</h3>
          <p>{{ habitacion?.tipo | titlecase }} • {{ habitacion?.camas || '—' }}</p>
        </ion-label>
      </ion-item>

      <ion-item>
        <ion-label>{{ 'pago.checkin' | translate }}</ion-label>
        <ion-note slot="end">{{ llegada | date:'dd/MM/yyyy' }} (14:00)</ion-note>
      </ion-item>

      <ion-item>
        <ion-label>{{ 'pago.checkout' | translate }}</ion-label>
        <ion-note slot="end">{{ salida | date:'dd/MM/yyyy' }} (12:00)</ion-note>
      </ion-item>

      <ion-item>
        <ion-label>{{ 'pago.nights' | translate }}</ion-label>
        <ion-note slot="end">{{ noches || 0 }} {{ (noches || 0) === 1 ? ('pago.nights' | translate) : ('pago.nights' | translate) }}</ion-note>
      </ion-item>

      <ion-item>
        <ion-label>{{ 'pago.pricePerNight' | translate }}</ion-label>
        <ion-note slot="end">{{ currency(habitacion?.precioNoche) }}</ion-note>
      </ion-item>

      <ion-item>
        <ion-label><strong>{{ 'pago.totalStay' | translate }}</strong></ion-label>
        <ion-note slot="end"><strong>{{ currency(totalEstadia) }}</strong></ion-note>
      </ion-item>

      <!-- Información de contacto -->
      <ion-list-header>
        <ion-label>{{ 'pago.contactInfo' | translate }}</ion-label>
      </ion-list-header>

      <form [formGroup]="contactForm">
        <ion-item>
          <ion-label position="stacked">{{ 'pago.fullName' | translate }}</ion-label>
          <ion-input formControlName="nombre" type="text" required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">{{ 'pago.email' | translate }}</ion-label>
          <ion-input formControlName="email" type="email" required></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">{{ 'pago.phone' | translate }}</ion-label>
          <ion-input formControlName="telefono" type="tel" required></ion-input>
        </ion-item>
      </form>

      <!-- Opciones de pago -->
      <ion-list-header>
        <ion-label>{{ 'pago.paymentOptions' | translate }}</ion-label>
      </ion-list-header>

      <ion-radio-group [(ngModel)]="opcionPago" (ionChange)="calcularPago()">
        <ion-item>
          <ion-label>{{ 'pago.fullPayment' | translate }}</ion-label>
          <ion-radio slot="start" value="completo"></ion-radio>
        </ion-item>

        <ion-item>
          <ion-label>{{ 'pago.partialPayment' | translate }}</ion-label>
          <ion-radio slot="start" value="parcial"></ion-radio>
        </ion-item>
      </ion-radio-group>

      <!-- Resumen de pago -->
      <ion-item *ngIf="opcionPago">
        <ion-label>
          <h3>{{ 'pago.amountToPay' | translate }}</h3>
          <p *ngIf="opcionPago === 'parcial'">(30% {{ 'pago.totalStay' | translate }})</p>
        </ion-label>
        <ion-note slot="end" color="primary">
          <strong>{{ montoAPagar | currency:'CLP':'symbol':'1.0-0' }}</strong>
        </ion-note>
      </ion-item>

      <!-- Método de pago -->
      <ion-list-header *ngIf="opcionPago">
        <ion-label>{{ 'pago.paymentMethod' | translate }}</ion-label>
      </ion-list-header>

      <ion-segment [(ngModel)]="metodoPago" *ngIf="opcionPago">
        <ion-segment-button value="transferencia">
          <ion-label>{{ 'pago.transfer' | translate }}</ion-label>
        </ion-segment-button>
        <ion-segment-button value="tarjeta">
          <ion-label>{{ 'pago.card' | translate }}</ion-label>
        </ion-segment-button>
      </ion-segment>

      <!-- Datos de transferencia -->
      <div *ngIf="opcionPago && metodoPago === 'transferencia'">
        <ion-item>
          <ion-label>
            <h3>{{ 'pago.bankDetails' | translate }}</h3>
            <p>{{ 'pago.account' | translate }}</p>
            <p>{{ 'pago.rut' | translate }}</p>
            <p>{{ 'pago.transferEmail' | translate }}</p>
          </ion-label>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">{{ 'pago.receipt' | translate }}</ion-label>
          <ion-input [(ngModel)]="comprobanteTransferencia" type="text"></ion-input>
        </ion-item>
      </div>

      <!-- Datos de tarjeta -->
      <div *ngIf="opcionPago && metodoPago === 'tarjeta'">
        <ion-item>
          <ion-label position="stacked">{{ 'pago.cardNumber' | translate }}</ion-label>
          <ion-input [(ngModel)]="tarjetaNumero" type="text" placeholder="1234 5678 9012 3456"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">{{ 'pago.cardName' | translate }}</ion-label>
          <ion-input [(ngModel)]="tarjetaNombre" type="text"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">{{ 'pago.cardExpiry' | translate }}</ion-label>
          <ion-input [(ngModel)]="tarjetaExpiracion" type="text" placeholder="MM/AA"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">{{ 'pago.cardCVV' | translate }}</ion-label>
          <ion-input [(ngModel)]="tarjetaCVV" type="text" placeholder="123"></ion-input>
        </ion-item>
      </div>

      <!-- Botón de confirmación -->
      <ion-button 
        expand="block" 
        color="success" 
        class="ion-margin-top"
        [disabled]="!formularioValido()"
        (click)="confirmarPago()">
        {{ 'pago.confirm' | translate }}
      </ion-button>

      <ion-note color="medium">
        {{ 'pago.confirmNote' | translate }}
      </ion-note>
    </ion-card-content>
  </ion-card>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>{{ 'home.footer' | translate }}</p>
    </div>
  </footer>
</ion-content>