<ion-header class="site-header">
  <ion-toolbar color="light">
    <div class="container navbar">
      <div class="brand">
        <ion-icon name="sparkles-outline"></ion-icon>
        <span>Hotel Pacific Reef</span>
      </div>

      <nav class="menu">
        <a routerLink="/home" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">{{ 'header.home' | translate }}</a>
        <a routerLink="/reservas" routerLinkActive="active">{{ 'header.reservas' | translate }}</a>
        <a routerLink="/perfil" routerLinkActive="active">{{ 'header.perfil' | translate }}</a>
        <span *ngIf="email" class="user-pill" [title]="email">{{ 'header.hello' | translate }} <b>{{ email }}</b></span>
        <a href="#" class="logout" (click)="logout($event)" aria-label="Cerrar sesiÃ³n" title="Cerrar sesiÃ³n">{{ 'header.logout' | translate }}</a>
      </nav>
    </div>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="site-content ion-padding page-content">
  <!-- Datos de la cuenta -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ 'perfil.title' | translate }}</ion-card-title>
      <ion-card-subtitle>{{ 'perfil.subtitle' | translate }}</ion-card-subtitle>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        <ion-item lines="full">
          <ion-label>
            <h2>{{ 'perfil.email' | translate }}</h2>
            <p>{{ email }}</p>
          </ion-label>
        </ion-item>
        
        <!-- Preferencia de idioma -->
        <ion-item lines="full">
          <ion-label>
            <h2>{{ 'perfil.language' | translate }}</h2>
            <p>{{ selectedLanguage === 'es' ? 'EspaÃ±ol' : 'English' }}</p>
          </ion-label>
          <ion-select [(ngModel)]="selectedLanguage" (ionChange)="changeLanguage()" interface="action-sheet">
            <ion-select-option value="es">EspaÃ±ol</ion-select-option>
            <ion-select-option value="en">English</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Mis reservas -->
  <ion-card>
    <ion-card-header>
      <ion-card-title>{{ 'perfil.reservas' | translate }}</ion-card-title>
      <ion-card-subtitle>{{ 'perfil.reservas.subtitle' | translate }}</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <ion-list *ngIf="reservas.length; else sinReservas">
        <ion-item *ngFor="let r of reservas; trackBy: trackById" class="res-item">
          <ion-label>
            <h3>#{{ r.id }} â€¢ {{ r.nombreHabitacion }} ({{ r.tipo | titlecase }})</h3>
            <p>ðŸ—“ {{ r.llegada }} â†’ {{ r.salida }} â€¢ {{ r.noches }} {{ (r.noches === 1 ? 'noche' : 'noches') | translate }}</p>
            <p>ðŸ’µ {{ currency(r.precioNoche) }} / {{ 'reservas.perNight' | translate }} â€¢ {{ 'pago.totalStay' | translate }}: <b>{{ currency(r.total) }}</b></p>
          </ion-label>

          <ion-buttons slot="end">
            <ion-button fill="clear" color="primary" (click)="abrirEditar(r)" aria-label="Editar reserva" title="Editar reserva">
              <ion-icon name="create-outline" slot="start"></ion-icon>
              {{ 'perfil.edit' | translate }}
            </ion-button>
            <ion-button fill="clear" color="danger" (click)="borrarReserva(r)" aria-label="Eliminar reserva" title="Eliminar reserva">
              <ion-icon name="trash-outline"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-item>
      </ion-list>

      <ng-template #sinReservas>
        <ion-text color="medium">
          {{ 'perfil.noReservas' | translate }} <a routerLink="/reservas">{{ 'perfil.reservasLink' | translate }}</a> {{ 'perfil.toCreate' | translate }}
        </ion-text>
      </ng-template>
    </ion-card-content>
  </ion-card>

  <!-- Modal: Editar fechas de la reserva -->
  <ion-modal [isOpen]="editOpen" (willDismiss)="cerrarEditar()" [backdropDismiss]="false">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>{{ 'perfil.editDates' | translate }}</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cerrarEditar()">{{ 'login.close' | translate }}</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">
        <ion-item>
          <ion-label position="stacked">{{ 'perfil.newArrival' | translate }}</ion-label>
          <ion-datetime
            [(ngModel)]="editLlegada"
            [min]="minDate"
            [max]="maxDate"
            presentation="date"
            aria-label="Seleccionar nueva fecha de llegada">
          </ion-datetime>
        </ion-item>

        <ion-item>
          <ion-label position="stacked">{{ 'perfil.newDeparture' | translate }}</ion-label>
          <ion-datetime
            [(ngModel)]="editSalida"
            [min]="minDate"
            [max]="maxDate"
            presentation="date"
            aria-label="Seleccionar nueva fecha de salida">
          </ion-datetime>
        </ion-item>

        <ion-text color="danger" *ngIf="editError">{{ editError }}</ion-text>

        <ion-button
          expand="block"
          color="primary"
          class="ion-margin-top"
          [disabled]="!puedeGuardarEdicion()"
          (click)="guardarEdicion()">
          {{ 'perfil.saveChanges' | translate }}
        </ion-button>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <p>{{ 'home.footer' | translate }}</p>
    </div>
  </footer>
</ion-content>